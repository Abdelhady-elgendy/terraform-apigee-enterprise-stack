name: terraform-deploy

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Target environment (dev/test/prod)"
        required: true
        default: "dev"
      working_dir:
        description: "Terraform root directory"
        required: true
        default: "examples/single-region"

permissions:
  contents: read

jobs:
  plan-apply:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    steps:
      - uses: actions/checkout@v4
      - uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: "1.6.6"
      - name: Terraform init
        run: |
          cd "${{ inputs.working_dir }}"
          terraform init -input=false
      - name: Terraform plan
        run: |
          cd "${{ inputs.working_dir }}"
          terraform plan -out=tfplan
      - name: Terraform apply
        run: |
          cd "${{ inputs.working_dir }}"
          terraform apply -input=false tfplan
